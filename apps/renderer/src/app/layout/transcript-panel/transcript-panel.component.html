<div class="transcript-panel">
  @if (isRecordingElsewhere) {
    <div class="recording-elsewhere-banner"
      tabindex="0"
      role="button"
      (click)="goToRecordingSession()"
      (keydown.enter)="goToRecordingSession()">
      <span class="recording-dot"></span>
      <span>{{ 'transcript.recordingElsewhere' | translate }}</span>
    </div>
  }
  <div class="segments-container" #scrollContainer>
    @for (segment of segments; track segment.id) {
      <div
        class="segment-block"
        [attr.data-segment-id]="segment.id"
        [class.highlighted]="isHighlighted(segment.id)"
        [class.edited]="segment.isEdited"
      >
        @if (editingSegmentId === segment.id) {
          <input
            class="segment-edit-input"
            [(ngModel)]="editingText"
            (keydown.enter)="saveSegmentEdit()"
            (keydown.escape)="cancelEdit()"
            (blur)="saveSegmentEdit()"
            autofocus
          />
        } @else {
          <span
            class="segment-text"
            (dblclick)="onSegmentDoubleClick(segment)"
            [title]="segment.isEdited ? 'Original: ' + segment.originalText : ''"
          >{{ segment.text }}</span>
        }
      </div>
    }

    @if (isSpeechActive) {
      <sdn-glitch-loader
        [messages]="['ECOUTE EN COURS...', 'TRANSCRIPTION...', 'DECODAGE AUDIO...', 'ANALYSE VOCALE...']"
        [typingSpeed]="40"
      ></sdn-glitch-loader>
    }

    @if (segments.length === 0 && !isSpeechActive) {
      <div class="empty-state">
        @switch (sttStatus) {
          @case ('loading') {
            <span>{{ 'transcript.loading' | translate }}<span class="loading-dots"></span></span>
          }
          @case ('error') {
            <span>
              {{ 'transcript.unavailable' | translate }}
              <button class="retry-btn" (click)="restartStt()">{{ 'transcript.retry' | translate }}</button>
            </span>
          }
          @default {
            <span>{{ 'transcript.empty' | translate }}</span>
          }
        }
      </div>
    }
  </div>
</div>
